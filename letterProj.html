<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Unsent Letters</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDxKouCI8XQbL8jyYH1hdR7hIzjzTfdwr8",
  authDomain: "letterproj-50461.firebaseapp.com",
  databaseURL: "https://letterproj-50461-default-rtdb.firebaseio.com",
  projectId: "letterproj-50461",
  storageBucket: "letterproj-50461.firebasestorage.app",
  messagingSenderId: "279086261495",
  appId: "1:279086261495:web:88ee450f45d2fb93611ff2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.saveLetter = () => {
  const to = document.getElementById("to").value.trim() || "Someone";
  const greeting = document.getElementById("greeting").value.trim();
  const message = document.getElementById("message").value.trim();
  const signature = document.getElementById("signature").value.trim();

  if (!message) return alert("Letter cannot be empty!");

  push(ref(db, "letters"), {
    to, greeting, message, signature, timestamp: Date.now()
  });

  document.getElementById("to").value = "";
  document.getElementById("greeting").value = "";
  document.getElementById("message").value = "";
  document.getElementById("signature").value = "";
};

window.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("envelopes");
  onChildAdded(ref(db, "letters"), snapshot => {
    const letter = snapshot.val();

    const env = document.createElement("div");
    env.className = "envelope-wrapper";
    env.innerHTML = `
      <div class="recipient">To: ${letter.to}</div>
      <div class="envelope">
        <div class="flap"></div>
        <div class="letter-content">
          ${letter.greeting ? `<p class="greeting">${letter.greeting}</p>` : ""}
          <p class="body">${letter.message}</p>
          ${letter.signature ? `<p class="signature">${letter.signature}</p>` : ""}
          <small>${new Date(letter.timestamp).toLocaleString()}</small>
          <button class="fold-btn">Fold</button>
        </div>
      </div>
    `;

    // Open letter smoothly
    const envelope = env.querySelector(".envelope");
    envelope.addEventListener("click", e => {
      if (!e.target.classList.contains("fold-btn")) {
        envelope.classList.add("open-full");
        setTimeout(() => env.querySelector(".letter-content").classList.add("visible"), 20);
      }
    });

    // Fold/close letter with smooth animation
    env.querySelector(".fold-btn").addEventListener("click", e => {
      e.stopPropagation();
      const content = env.querySelector(".letter-content");
      content.classList.remove("visible");
      setTimeout(() => envelope.classList.remove("open-full"), 400);
    });

    container.prepend(env);
  });
});
</script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Sacramento&display=swap');

body {
  font-family: "Georgia", serif;
  background-color: #fdfaf7;
  margin: 0;
  padding: 15px;
  text-align: center;
}

h1 { color: #a94442; margin-bottom: 20px; }

input, textarea, button {
  display: block;
  margin: 8px auto;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 90%;
  max-width: 300px;
  font-size: 16px;
  box-sizing: border-box;
}

button {
  background-color: #a94442;
  color: white;
  border: none;
  cursor: pointer;
  transition: 0.3s;
}

button:hover { background-color: #84343c; }

#envelopes {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  margin-top: 25px;
}

/* Envelope wrapper including recipient */
.envelope-wrapper {
  text-align: center;
}

.recipient {
  font-weight: bold;
  margin-bottom: 5px;
  color: #6a3e3e;
}

/* Envelope styling */
.envelope {
  width: 180px;
  height: 110px;
  background: #f4c2c2;
  position: relative;
  cursor: pointer;
  perspective: 800px;
  border-radius: 8px;
  overflow: hidden;
  transition: transform 0.6s;
}

.envelope:hover .flap {
  transform: rotateX(-10deg);
}

.envelope .flap {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 50px;
  background: #f08080;
  transform-origin: top;
  transition: transform 0.6s ease;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
}

.envelope .letter-content {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #fffefc; /* simple paper color */
  padding: 10px;
  box-sizing: border-box;
  transform: translateY(40px) scale(0.8);
  opacity: 0;
  border-radius: 8px;
  overflow-wrap: break-word;
  word-wrap: break-word;
  overflow: hidden;
  font-size: 14px;
  transition: all 0.6s ease-in-out;
  line-height: 1.5em;
  font-family: 'Sacramento', cursive;
}

.letter-content.visible {
  transform: translateY(0) scale(1);
  opacity: 1;
}

/* Fullscreen letter */
.envelope.open-full {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(1);
  width: 80vw;
  height: 70vh;
  max-width: 500px;
  max-height: 600px;
  z-index: 1000;
  border-radius: 12px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.3);
}

.envelope.open-full .flap {
  transform: rotateX(180deg);
}

.envelope.open-full .letter-content {
  padding: 25px;
  font-size: 18px;
  overflow-y: auto;
}

/* Mobile adjustments */
@media (max-width: 480px) {
  .envelope.open-full .letter-content {
    font-size: 22px;  /* larger for phones */
    padding: 20px;
  }
}

.letter-content .greeting { margin-bottom: 15px; font-style: italic; }
.letter-content .body { margin-bottom: 20px; }
.letter-content .signature { text-align: right; font-weight: bold; margin-top: 20px; }

.fold-btn {
  margin-top: 10px;
  padding: 8px 16px;
  background-color: #a94442;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
}

.fold-btn:hover { background-color: #84343c; }
</style>
</head>

<body>
<h1>Unsent Letters</h1>
<input type="text" id="to" placeholder="To (optional)">
<input type="text" id="greeting" placeholder="Greeting (optional)">
<textarea id="message" placeholder="Write your letter here..." required></textarea>
<input type="text" id="signature" placeholder="Signature (optional)">
<button onclick="saveLetter()">Send Letter</button>

<div id="envelopes"></div>
</body>
</html>
